# 姿态检测基础知识

## 01 - soft-argmax

soft-argmax将热点图转换为数值坐标应用于人体姿态估计

> 人体姿态估计常用预测热点图的方法预测x和y的坐标值，热点图可以理解为概率响应图，通过求热点图最大值所在位置坐标，就可以得到该关键点的位置坐标



### 热点图法的缺点

1. 量化产生的精度损失：卷积网络下采样使模型的计算量减小，输出可能是输入图像大小的四分之一，而坐标经过量化[x/n]再还原回去，就不可避免的产生偏差
2. 监督热点图标签，不是直接的监督坐标，有一定问题，如下图。（为什么不直接回归坐标呢？实验证明直接输出坐标不如监督热点图，如何结合起来？于是有了**soft-argmax**）

![](https://raw.githubusercontent.com/lxy5513/Markdown_image_dateset/master/Xnip2018-12-29_11-49-47.png)

## soft-argmax


思想就是如何通过热点图，用某种计算方法得到坐标。

在文献【2】中叫积分法，图像中的积分是累加和，我的理解就是加权求和。下面按照文献【3】中的描述具体介绍

1. 对关键点的热点图作归一化，目的是使得下一步的加权求和范围在0-1之间

![](https://raw.githubusercontent.com/lxy5513/Markdown_image_dateset/master/Xnip2018-12-29_11-54-07.png)



1. 分别用x,y两个与热点图大小一样的卷积核对归一化后的热点图加权就和，等价于对应元素相乘再相加，等价于卷积运算

![](https://raw.githubusercontent.com/lxy5513/Markdown_image_dateset/master/Xnip2018-12-29_11-54-37.png)



### 优缺点

#### 优点：

一定意义上缓解了量化精度损失问题，可以直接学习热点图和位置坐标，学习的目标更直接。网络可以直接输出所需目标，一体化程度高。

个人的实验发现，实现soft-argmax可以采用分组卷积，即输入是k个通道（k表示关键点个数），则分组为k，分组卷积指通道上不做卷积的聚合。

#### 缺点：

会增加训练所需时间，毕竟加了一层运算，如果输入热点图的尺寸较大如128，应该是会增加一点时间的。测试时间影响不大，因为没有soft-argmax也要用argmax，所以测试速度应该影响不大。



## 02 HoG(Histogram of oriented gradient)

### 特征描述子(Feature Descriptor)

特征描述子就是图像的表示，抽取了有用的信息，丢掉了不相关的信息。通常特征描述子会把一个w*h*3(宽高3，3个channel)的图像转换成一个长度为n的向量/矩阵。比如一副64*128*3的图像，经过转换后输出的图像向量长度可以是3780。

什么样子的特征是有用的呢？假设我们想要预测一张图片里面衣服上面的扣子，扣子通常是圆的，而且上面有几个洞，那你就可以用边缘检测(edge detector)，把图片变成只有边缘的图像，然后就可以很容易的分辨了，那么对于这张图边缘信息就是有用的，颜色信息就是没有用的。而且好的特征应该能够区分纽扣和其它圆形的东西的区别。

方向梯度直方图(HOG)中，梯度的方向分布被用作特征。沿着一张图片X和Y轴的方向上的梯度是很有用的，因为在边缘和角点的梯度值是很大的，我们知道边缘和角点包含了很多物体的形状信息。

### 方向梯度直方图

用于目标检测的特征描述器，用来计算局部图像梯度方向信息的统计值

#### 思想

局部目标的表象和形状（appearence and shape) 能够被梯度或者边缘的方向密度分别很好的描述。

#### 实现方法

首先将图像分成小的连通区域，我们把它叫细胞单元。然后采集细胞单元中各像素点的梯度的或边缘的方向直方图。最后把这些直方图组合起来就可以构成特征描述器。





## 03 regress or detection

- #### Regression

  - Low accuracy in high precision region caused by flexible body movement 
  - Hard to extend when pose estimation is used for unknown number of person  

- #### Detection

  - 得到对应的heatmap 
  - 用热点图谱的响应值来反应人体的不同部位，不同的部位获得的响应应该是不同的，比如说感兴趣的区域（例如头部），需要返回一个较高的响应。



## 04 structure info

 **graph model**  $$\ \ \  G = (V, E ) $$

- #### Vertices

  - locations and mixture types of body parts 
  - modeled by a front-end CNN 

- #### Edges

  - Pairwise spatial relationships between body parts 
  - Modeled by message passing layers 



### 05 **图像\视频 获取2D/3D信息**

前文所讲，都是基于2D图片获得姿态预测结果，即我们得到的只是在图片中人体的2D位置的坐标（x,y）。然而，人是在3D世界中的真实存在，我们其实还可以获取另外一个维度的信息，即**深度信息**。现有研究结果表明，只从一个简单的RGB图像是可以获得图像的3D信息的。其方法如下：首先获得2D位置预测，通过堆叠沙漏型的网络结构，得到一个3D位置的初步、粗略的预测信息，再进一步堆叠网络结构进行精细化的处理，最终会得到一个非常精细的3D信息预测结果。

从视频来做三维姿态估计，应用到的很重要的点是，相邻帧之间的视觉信息应该是连续的，因而人的姿态在相邻帧之间的变化也会是连续的，因而可以**利用这些信息的连贯性**，来改进人体在3D或者2D中姿态识别的预测结果。

